#!/usr/bin/bash
# /etc/X11/xinit/xinitrc, jpf@centauri (c) 2019-2024

# wait until WM is up
run_wmctrl() {
    sleep 0.4               # wait until wm is ready ...
    if ! wmctrl -s0 ; then
        sleep 0.8
        wmctrl -s0 || sleep 1
    fi >/dev/null 2>&1
}

# handle centaurilogin 
if [ -x .centauristartup ] ; then
    if [ -x /usr/bin/xfwm4 ] ; then
        # load resolution dependend autogenerated X resources
        [ -r "/etc/X11/Xresources/centauridisplay" ] && xrdb "/etc/X11/Xresources/centauridisplay"
        /usr/bin/xfwm4 --sm-client-disable & WMPID=$!
        run_wmctrl
        ./.centauristartup
    else
        xmessage "please install 'xfwm4'"
    fi

# start a desktop
elif [ -x /usr/bin/startplasma-x11 ] ; then
    export XDG_CURRENT_DESKTOP="KDE"
    . /etc/X11/Xsession
    startplasma-x11
    pkill -g 0 plasma_session
elif [ -x /usr/bin/startlxqt ] ; then
    export XDG_CURRENT_DESKTOP="LXQt"
    . /etc/X11/Xsession
    startlxqt
elif [ -x /usr/bin/startkde ] ; then
    export XDG_CURRENT_DESKTOP="KDE"
    . /etc/X11/Xsession
    startkde
elif [ -x /usr/bin/xfwm4 ] ; then
    # load resolution dependend autogenerated X resources
    [ -r "/etc/X11/Xresources/centauridisplay" ] && xrdb "/etc/X11/Xresources/centauridisplay"
    /usr/bin/xfwm4 & WMPID=$!
    run_wmctrl
    xterm -fullscreen -sb -rightbar -ls 
elif [ -x /usr/bin/twm ] ; then
    # load resolution dependend autogenerated X resources
    [ -r "/etc/X11/Xresources/centauridisplay" ] && xrdb "/etc/X11/Xresources/centauridisplay"
    twm &
    xclock -g 130x130+900+10 &
    xterm -g 120x35+10+10 -sb
else
    . /etc/X11/Xsession
fi

[ -n "$WMPID" ] && kill $WMPID             # quit after xterm close
